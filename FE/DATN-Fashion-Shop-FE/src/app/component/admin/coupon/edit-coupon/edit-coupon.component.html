<app-header-admin title_header="Coupon" title_btn="Add Item"
                  routerLinkString="/admin/edit_coupon"></app-header-admin>





<form #couponForm="ngForm" novalidate enctype="multipart/form-data">
  <!-- Dropdown ch·ªçn ng√†y l·ªÖ -->
  <div class="form-group">
    <label>Ch·ªçn ng√†y l·ªÖ</label>
    <select class="form-select" required name="holidayId" [(ngModel)]="selectedHolidayId" #holiday="ngModel"
            (change)="onHolidayChange($event)"
            [ngClass]="{'is-invalid': holiday.invalid && holiday.touched}">

      <option *ngFor="let holiday of holidays" [value]="holiday.id">
        {{ holiday.holidayName }}
      </option>
    </select>
    <div *ngIf="holiday.invalid && holiday.touched" class="invalid-feedback">
      <small>Vui l√≤ng ch·ªçn ng√†y l·ªÖ.</small>
    </div>
  </div>
  <!-- Lo·∫°i gi·∫£m gi√° -->
  <div class="form-group">
    <label>Lo·∫°i gi·∫£m gi√°</label>
    <select [(ngModel)]="couponData.discountType" name="discountType" #discountType="ngModel"
            class="form-control" required (change)="onDiscountTypeChange()"
            [ngClass]="{'is-invalid': discountType.invalid && discountType.touched}">
      <option value="PERCENTAGE">Ph·∫ßn trƒÉm</option>
      <option value="FIXED">S·ªë ti·ªÅn c·ªë ƒë·ªãnh</option>
    </select>
    <div *ngIf="discountType.invalid && discountType.touched" class="invalid-feedback">
      <small>Vui l√≤ng ch·ªçn lo·∫°i gi·∫£m gi√°.</small>
    </div>
  </div>

  <!-- Gi√° tr·ªã gi·∫£m -->
  <div class="form-group">
    <label>Gi√° tr·ªã gi·∫£m {{ couponData.discountType === 'PERCENTAGE' ? '(%)' : '(VNƒê)' }}</label>
    <input type="number" [(ngModel)]="couponData.discountValue" name="discountValue" #discountValue="ngModel"
           class="form-control" required
           [attr.min]="minDiscountValue"
           [attr.max]="maxDiscountValue"
           [ngClass]="{'is-invalid': discountValue.invalid && discountValue.touched}" />
    <div *ngIf="discountValue.invalid && discountValue.touched" class="invalid-feedback">
      <small>Gi√° tr·ªã gi·∫£m ph·∫£i t·ª´ {{ minDiscountValue }} ƒë·∫øn {{ maxDiscountValue }}.</small>
    </div>
  </div>

  <!-- Gi√° tr·ªã ƒë∆°n h√†ng t·ªëi thi·ªÉu -->
  <div class="form-group">
    <label>Gi√° tr·ªã ƒë∆°n h√†ng t·ªëi thi·ªÉu (VNƒê)</label>
    <input type="number" [(ngModel)]="couponData.minOrderValue" name="minOrderValue" #minOrderValue="ngModel"
           class="form-control" required min="100000"
           [ngClass]="{'is-invalid': minOrderValue.invalid && minOrderValue.touched}" />
    <div *ngIf="minOrderValue.invalid && minOrderValue.touched" class="invalid-feedback">
      <small>Gi√° tr·ªã ƒë∆°n h√†ng t·ªëi thi·ªÉu ph·∫£i t·ª´ 100000 VNƒê tr·ªü l√™n.</small>
    </div>
  </div>

  <!-- S·ªë ng√†y h·∫øt h·∫°n -->
  <div class="form-group">
    <label>S·ªë ng√†y h·∫øt h·∫°n</label>
    <input type="number" [(ngModel)]="couponData.expirationDays" name="expirationDays" #expirationDays="ngModel"
           class="form-control" required min="3" max="30"
           [ngClass]="{'is-invalid': expirationDays.invalid && expirationDays.touched}" />
    <div *ngIf="expirationDays.invalid && expirationDays.touched" class="invalid-feedback">
      <small>S·ªë ng√†y h·∫øt h·∫°n ph·∫£i t·ª´ 3 ƒë·∫øn 30 ng√†y.</small>
    </div>
  </div>

  <!-- ·∫¢nh -->
  <div class="form-group">
    <label>Ch·ªçn ·∫£nh</label>
    <input type="file" (change)="onFileSelected($event)" class="form-control" />
  </div>

  <!-- N√∫t g·ª≠i -->
  <button type="button" class="btn btn-primary"
          [disabled]="couponForm.invalid"
          (click)="createCoupon()">
    {{ 'T·∫°o m√£ gi·∫£m gi√°' }}
  </button>

</form>

<table class="coupon-table" *ngIf="couponConfigs && Object.keys(couponConfigs).length > 0">
  <thead>
  <tr>
    <th>Code</th>
    <th>Lo·∫°i</th>
    <th>Gi√° tr·ªã</th>
    <th>ƒê∆°n h√†ng t·ªëi thi·ªÉu</th>
    <th>Ng√†y h·∫øt h·∫°n</th>
    <th>H√¨nh ·∫£nh</th>
    <th>H√†nh ƒë·ªông</th> <!-- C·ªôt m·ªõi -->
  </tr>
  </thead>
  <tbody>
  <tr *ngFor="let key of Object.keys(couponConfigs)">
    <td>{{ key }}</td>
    <td>{{ couponConfigs[key]?.discountType || '-' }}</td>
    <td>{{ couponConfigs[key]?.discountValue || '-' }}</td>
    <td>{{ couponConfigs[key]?.minOrderValue || '-' }}</td>
    <td>{{ couponConfigs[key]?.expirationDays || '-' }}</td>
    <td>
      <img *ngIf="couponConfigs[key]?.imageUrl" [src]="'http://localhost:8080/uploads/coupons/' + couponConfigs[key]?.imageUrl" alt="Coupon Image" width="50">
    </td>
    <td>
      <button class="edit-btn" (click)="editCoupon(key)">‚úèÔ∏è S·ª≠a</button>
      <button class="delete-btn" (click)="resetCoupon(key)">üóëÔ∏è X√≥a</button>
    </td>
  </tr>
  </tbody>
</table>


